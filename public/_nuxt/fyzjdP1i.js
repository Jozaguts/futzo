import{j as S,r as n,k as h}from"./016mahUR.js";import{u as k}from"./Bd6NytqX.js";const O=S("teamStore",()=>{const{toast:i}=k(),m=n(!1),l=n(),g=n(),y=n(0),T=n(""),d=n(!1),r=n({currentPage:1,perPage:10,lastPage:1,total:0,sort:"asc"}),s=n({}),c=h(),w=n({current:"createTeam",steps:[{step:"createTeam",completed:!1,label:"Crea un equipo"},{step:"createDt",completed:!1,label:"Crea el DT"},{step:"createOwner",completed:!1,label:"Crea el presidente"}]}),q=n(!1),u=n(!1),$=async()=>{u.value=!0,await c("/api/v1/admin/teams/template",{method:"GET"}).then(a=>{const o=window.URL.createObjectURL(new Blob([a])),t=document.createElement("a");t.href=o,t.setAttribute("download","template.xlsx"),document.body.appendChild(t),t.click()}).catch(a=>{var o;i("error","Error al descargar la plantilla",((o=a.data)==null?void 0:o.message)??"No se pudo descargar la plantilla. Inténtalo de nuevo.")}).finally(()=>{u.value=!1})};async function E(a,o){const t=new FormData;t.append("tournament_id",o.toString()),t.append("file",a),await c("/api/v1/admin/teams/import",{method:"POST",body:t}).then(async()=>{i("success","Equipos Importados","Los equipos se han importado exitosamente."),d.value=!1,await p()}).catch(e=>{var f;i("error","Error al importar equipos",((f=e.data)==null?void 0:f.message)??"No se pudieron importar los equipos. Verifica tu archivo e inténtalo de nuevo.")})}const b=async()=>{let a=v();await c("/api/v1/admin/teams",{method:"POST",body:a}).then(async()=>{await p(),i("success","Equipo Creado","El nuevo equipo se ha creado exitosamente."),m.value=!1}).catch(o=>{var t;i("error","Error al crear el equipo",((t=o.data)==null?void 0:t.message)??"No se pudo crear el equipo. Verifica tu información e inténtalo de nuevo.")})},P=async a=>{let o=v();await c(`/api/v1/admin/teams/${a}`,{method:"PUT",body:o}).then(async()=>{await p(),i("success","Equipo actualizado","El equipo se ha actualizado exitosamente"),m.value=!1}).catch(t=>{var e;i("error","Error al actualizar el equipo",((e=t.data)==null?void 0:e.message)??"No se pudo actualizar el equipo. Verifica tu información e inténtalo de nuevo.")})},v=()=>{var o;let a=new FormData;for(const t in s.value)if(t==="team")for(const e in s.value.team)((o=s.value)==null?void 0:o.team[e])instanceof File&&a.append(`team[${e}]`,s.value.team[e]),typeof s.value.team[e]=="object"&&e==="colors"||e==="address"?a.append(`team[${e}]`,JSON.stringify(s.value.team[e])):a.append(`team[${e}]`,s.value.team[e]);else if(t==="coach")for(const e in s.value.coach)s.value.coach[e]instanceof File?a.append(`coach[${e}]`,s.value.coach[e]):a.append(`coach[${e}]`,s.value.coach[e]);else if(t==="president")for(const e in s.value.president)s.value.president[e]instanceof File?a.append(`president[${e}]`,s.value.president[e]):a.append(`president[${e}]`,s.value.president[e]);return a},p=async()=>{try{await c(`/api/v1/admin/teams?per_page=${r.value.perPage}&page=${r.value.currentPage}&sort=${r.value.sort}`).then(({data:a,pagination:o})=>{l.value=a||[],r.value={...r.value,...o}})}catch(a){console.log(a)}};return{teams:l,team:g,dialog:m,steps:w,isEdition:q,teamStoreRequest:s,teamId:y,pagination:r,search:T,importModal:d,loading:u,createTeam:b,getTeams:p,getTeam:async a=>{try{return await c(`/api/v1/admin/teams/${a}`)}catch(o){console.log(o)}},updateTeam:P,list:async()=>{try{l.value=await c("/api/v1/admin/teams/list")}catch(a){console.log(a)}},importTeamsHandler:E,downloadTemplate:$,searchTeams:(a="")=>{h()(`/api/v1/admin/teams/search?value=${a}`).then(({data:t,pagination:e})=>{l.value=t||[],r.value={...r.value,...e}})}}});export{O as u};
