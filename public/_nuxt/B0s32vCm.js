import{j as C,c as P,r as n,J as U,k as m}from"./016mahUR.js";import{c as w}from"./0QfyqDfL.js";import{u as g}from"./Bd6NytqX.js";const D=c=>{var r;return{code:(r=c==null?void 0:c.response)==null?void 0:r.status,message:c.data.message}},q=C("locationStore",()=>{const c=P(()=>i.value.availability.filter(s=>s.isCompleted).length),r=P(()=>i.value.availability.every(s=>s.isCompleted)&&i.value.completed||h.value.current==="location"&&i.value.completed||f.value),a=n(),i=n({name:"",city:"",address:"",autocomplete_prediction:{},tags:[],availability:[],fields_count:0,position:w}),d=n(!1),f=n(!1),b=n({}),u=n({id:null,show:!1}),o=n({currentPage:1,perPage:8,lastPage:1,total:0,sort:"asc"}),h=n({current:"location",steps:[{step:"location",completed:!1,label:"Ubicación"},{step:"availability",completed:!1,label:"Disponibilidad"}]}),S=()=>{L(),d.value=!1,f.value=!1,b.value={},u.value={id:null,show:!1},o.value={currentPage:1,perPage:8,lastPage:1,total:0,sort:"asc"},a.value=[]};async function y(){o.value={currentPage:1,perPage:8,lastPage:1,total:0,sort:"asc"},await v()}function L(){i.value={name:"",city:"",address:"",autocomplete_prediction:{},tags:[],availability:[],fields_count:0,position:w,completed:!1}}async function v(s){const e=m(),t=`/api/v1/admin/locations?per_page=${o.value.perPage}&page=${o.value.currentPage}&sort=${o.value.sort}`;await e(t+(s?`&search=${s}`:"")).then(({data:l,meta:p})=>{o.value={currentPage:p.current_page,lastPage:p.last_page,perPage:p.per_page,total:p.total,sort:o.value.sort},o.value.currentPage>1?a.value=[...a.value,...l]:(a.value=l,console.log(a.value))})}async function _(){await m()("/api/v1/admin/locations",{method:"POST",body:i.value}).then(async e=>{var l;(l=a.value)==null||l.splice(0,0,e),await y();const{toast:t}=g();t("success","Ubicación creada","La  nueva ubicación se ha agregado exitosamente."),d.value=!1}).catch(e=>{const{message:t}=D(e),{toast:l}=g();l("error","Error al crear la ubicación",t??"Ocurrió un error al intentar crear la ubicación.")})}async function E(){var e;await m()(`/api/v1/admin/locations/${(e=b.value)==null?void 0:e.id}`,{method:"PUT",body:i.value}).then(async()=>{await y();const{toast:t}=g();t("success","Ubicación actualizada","La ubicación se ha actualizado exitosamente."),d.value=!1})}async function T(){await m()(`/api/v1/admin/locations/${u.value.id}`,{method:"DELETE"}).then(async()=>{var t;await v();const{toast:e}=g();e("success","Ubicación eliminada","La ubicación se ha eliminado exitosamente."),a.value=(t=a.value)==null?void 0:t.filter(l=>l.id!==u.value.id),u.value.show=!1,u.value.id=null})}const $=P(()=>!a.value||a.value.length===0);return U(async()=>{a.value||await v()}),{locations:a,locationStoreRequest:i,locationDialog:d,noLocations:$,isEdition:f,locationCard:b,locationToDelete:u,pagination:o,formSteps:h,stepsCompleted:c,isAllStepsCompleted:r,deleteLocation:T,storeLocation:_,updateLocation:E,getLocations:v,resetLocationStoreRequest:L,reloadLocations:y,$reset:S}});export{q as a,D as u};
